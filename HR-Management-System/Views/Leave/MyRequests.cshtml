@model IEnumerable<LeaveRequest>
@{
    ViewData["Title"] = "My Leave Requests";
}

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-4 border-bottom">
    <h1 class="h2">
        <i class="fas fa-history me-2"></i>My Leave Requests
    </h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="/Leave/Apply" class="btn btn-success">
            <i class="fas fa-plus-circle me-1"></i>Apply for Leave
        </a>
    </div>
</div>

@* @if (TempData["SuccessMessage"] != null) *@
@* { *@
@*     <div class="alert alert-success alert-dismissible fade show" role="alert"> *@
@*         <i class="fas fa-check-circle me-2"></i>@TempData["SuccessMessage"] *@
@*         <button type="button" class="btn-close" data-bs-dismiss="alert"></button> *@
@*     </div> *@
@* } *@

<div class="card">
    <div class="card-header bg-white">
        <h5 class="card-title mb-0">Leave Request History</h5>
    </div>
    <div class="card-body">
        @if (!Model.Any())
        {
            <div class="text-center py-5">
                <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                <h4 class="text-muted">No Leave Requests</h4>
                <p class="text-muted">You haven't submitted any leave requests yet.</p>
                <a href="/Leave/Apply" class="btn btn-primary mt-2">
                    <i class="fas fa-plus-circle me-1"></i>Apply for Your First Leave
                </a>
            </div>
        }
        else
        {
            <div class="table-responsive">
                <table class="table table-striped table-hover" id="leavesTable">
                    <thead class="table-dark">
                        <tr>
                            <th>Period</th>
                            <th>Type</th>
                            <th>Days</th>
                            <th>Reason</th>
                            <th>Status</th>
                            <th>Applied On</th>
                            <th>Manager Comments</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var request in Model)
                        {
                            var days = (request.EndDate - request.StartDate).Days + 1;
                            var statusClass = request.Status switch
                            {
                                "Approved" => "success",
                                "Rejected" => "danger",
                                _ => "warning"
                            };

                            <tr>
                                <td>
                                    <strong>@request.StartDate.ToString("MMM dd")</strong> -
                                    <strong>@request.EndDate.ToString("MMM dd, yyyy")</strong>
                                </td>
                                <td>
                                    <span class="badge bg-info">@request.LeaveType</span>
                                </td>
                                <td>
                                    <span class="fw-bold">@days day(s)</span>
                                </td>
                                <td>
                                    <span class="d-inline-block text-truncate" style="max-width: 200px;"
                                          title="@request.Reason">
                                        @request.Reason
                                    </span>
                                </td>
                                <td>
                                    <span class="badge bg-@statusClass">@request.Status</span>
                                </td>
                                <td>@request.CreatedAt.ToString("MMM dd, yyyy")</td>
                                <td>
                                    @if (!string.IsNullOrEmpty(request.ManagerComments))
                                    {
                                        <span class="text-muted">@request.ManagerComments</span>
                                    }
                                    else
                                    {
                                        <span class="text-muted">-</span>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            $('#leavesTable').DataTable({
                "order": [[5, "desc"]], // Sort by Applied On descending
                "responsive": true
            });
        });
    </script>
}